<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Copilot: 73-file scaffold - Complete GitHub Pages integration -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lotus Payday Loan Simulator - Complete Integration</title>
  
  <!-- Core Stylesheets -->
  <link rel="stylesheet" href="assets/global.css">
  <link rel="stylesheet" href="predatory/styles.css" id="predatory-styles">
  <link rel="stylesheet" href="ethical/styles.css" id="ethical-styles" disabled>
  <link rel="stylesheet" href="css/main.css">
  
  <!-- Module Preloads for Performance -->
  <link rel="modulepreload" href="assets/global.js">
  <link rel="modulepreload" href="core/loan_core.js">
  <link rel="modulepreload" href="engine/autonomy_theater.js">
  <link rel="modulepreload" href="engine/behavioralPsychology.js">
  <link rel="modulepreload" href="research/research_analytics.js">
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a1a; color: white; display: flex; align-items: center; justify-content: center; z-index: 9999;">
    <div style="text-align: center;">
      <div style="font-size: 24px; margin-bottom: 20px;">Loading Lotus...</div>
      <div style="width: 200px; height: 4px; background: #333; border-radius: 2px; overflow: hidden;">
        <div id="loading-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #ff6b6b, #4ecdc4); transition: width 0.3s;"></div>
      </div>
    </div>
  </div>

  <!-- Mode Switcher -->
  <div class="mode-switcher-panel">
    <div class="mode-switcher-header">
      <h3>Lotus Simulation Mode</h3>
      <p>Experience both interfaces to understand the difference</p>
    </div>
    <div class="mode-options">
      <label class="mode-option predatory-option active" data-mode="predatory">
        <input type="radio" name="interface-mode" value="predatory" checked>
        <div class="mode-card">
          <div class="mode-title">Predatory Interface</div>
          <div class="mode-desc">Dark patterns, urgency, manipulation</div>
        </div>
      </label>
      <label class="mode-option ethical-option" data-mode="ethical">
        <input type="radio" name="interface-mode" value="ethical">
        <div class="mode-card">
          <div class="mode-title">Ethical Redesign</div>
          <div class="mode-desc">Transparency, education, choice</div>
        </div>
      </label>
    </div>
    <button id="terminal-toggle" class="terminal-toggle">üñ•Ô∏è Terminal</button>
  </div>

  <!-- Terminal Overlay -->
  <div id="terminal-overlay" class="terminal-overlay hidden">
    <div class="terminal-window">
      <div class="terminal-header">
        <span>Lotus Analytics Terminal</span>
        <button id="terminal-close">√ó</button>
      </div>
      <div id="terminal-content" class="terminal-content">
        <div class="terminal-line">Lotus Research Analytics System v2.1</div>
        <div class="terminal-line">Monitoring user behavior patterns...</div>
      </div>
    </div>
  </div>

  <!-- Main Content Container -->
  <main id="main-content">
    <!-- Predatory Interface -->
    <section id="predatory-interface" class="interface-section active">
      <div id="predatory-hero-content"></div>
      <div id="predatory-slider-content"></div>
      <div id="predatory-form-content"></div>
      <div id="predatory-faq-content"></div>
      <div id="predatory-trust-signals-content"></div>
      <div id="predatory-terms-content"></div>
    </section>

    <!-- Ethical Interface -->
    <section id="ethical-interface" class="interface-section">
      <div id="ethical-hero-content"></div>
      <div id="ethical-form-step1-content"></div>
      <div id="ethical-form-step2-content"></div>
      <div id="ethical-apr-display-content"></div>
      <div id="ethical-education-content"></div>
      <div id="ethical-calculator-content"></div>
      <div id="ethical-alternatives-content"></div>
      <div id="ethical-footer-content"></div>
    </section>
  </main>

  <!-- Research Analytics Overlay -->
  <div id="analytics-overlay" class="analytics-overlay">
    <div class="analytics-panel">
      <h4>Research Data</h4>
      <div id="analytics-data"></div>
    </div>
  </div>

  <!-- Core Scripts -->
  <script type="module" src="assets/global.js"></script>
  <script type="module" src="core/loan_core.js"></script>
  
  <!-- Engine Scripts -->
  <script type="module" src="engine/autonomy_theater.js"></script>
  <script type="module" src="engine/behavioralPsychology.js"></script>
  <script type="module" src="engine/echo.js"></script>
  <script type="module" src="engine/kant.js"></script>
  
  <!-- Research Scripts -->
  <script type="module" src="research/research_analytics.js"></script>
  <script type="module" src="research/researchDataCollector.js"></script>
  
  <!-- UI Component Scripts -->
  <script type="module" src="ui_components/aprCalculator.js"></script>
  <script type="module" src="ui_components/aprTransparencyMeter.js"></script>
  <script type="module" src="ui_components/behaviorReplay.js"></script>
  <script type="module" src="ui_components/consentBar.js"></script>
  <script type="module" src="ui_components/consentCheck.js"></script>
  <script type="module" src="ui_components/darkPatternEngine.js"></script>
  <script type="module" src="ui_components/darkPatternFlags.js"></script>
  <script type="module" src="ui_components/debtCycleSimulator.js"></script>
  <script type="module" src="ui_components/educationalAssessment.js"></script>
  <script type="module" src="ui_components/educationalScaffolding.js"></script>
  <script type="module" src="ui_components/ethicsFeedback.js"></script>
  <script type="module" src="ui_components/legalLoopholeIndex.js"></script>
  <script type="module" src="ui_components/promptEngine.js"></script>
  <script type="module" src="ui_components/trapUIEngine.js"></script>
  
  <!-- Mode-specific Scripts -->
  <script type="module" src="predatory/countdown.js"></script>
  <script type="module" src="modes/ethical.js"></script>
  <script type="module" src="modes/exploitative.js"></script>
  
  <!-- Component Scripts -->
  <script type="module" src="components/reflection.js"></script>
  <script type="module" src="narrator/ghost.js"></script>
  
  <!-- Main Application Script -->
  <script type="module">
    // Copilot: Complete dynamic content loader for GitHub Pages
    class LotusGitHubPagesLoader {
      constructor() {
        this.loadedContent = new Set();
        this.currentMode = 'predatory';
        this.contentMap = {
          predatory: [
            { id: 'predatory-hero-content', file: 'predatory/hero.html' },
            { id: 'predatory-slider-content', file: 'predatory/slider.html' },
            { id: 'predatory-form-content', file: 'predatory/form.html' },
            { id: 'predatory-faq-content', file: 'predatory/faq.html' },
            { id: 'predatory-trust-signals-content', file: 'predatory/trust-signals.html' },
            { id: 'predatory-terms-content', file: 'predatory/terms.html' }
          ],
          ethical: [
            { id: 'ethical-hero-content', file: 'ethical/hero.html' },
            { id: 'ethical-form-step1-content', file: 'ethical/form-step1.html' },
            { id: 'ethical-form-step2-content', file: 'ethical/form-step2.html' },
            { id: 'ethical-apr-display-content', file: 'ethical/apr-display.html' },
            { id: 'ethical-education-content', file: 'ethical/education.html' },
            { id: 'ethical-calculator-content', file: 'partials/ethical/calculator.html' },
            { id: 'ethical-alternatives-content', file: 'partials/ethical/alternatives.html' },
            { id: 'ethical-footer-content', file: 'partials/ethical/footer.html' }
          ]
        };
        this.init();
      }

      async init() {
        this.updateLoadingProgress(10);
        await this.loadAllContent();
        this.setupModeSwitch();
        this.setupTerminal();
        this.initializeAnalytics();
        this.updateLoadingProgress(100);
        setTimeout(() => this.hideLoading(), 500);
        
        // Initialize Lotus app if available
        if (window.LotusApp) {
          window.LotusApp.currentInterface = 'github-pages';
          console.log('Lotus GitHub Pages integration complete');
        }
      }

      async loadAllContent() {
        const allContent = [...this.contentMap.predatory, ...this.contentMap.ethical];
        const total = allContent.length;
        let loaded = 0;

        for (const content of allContent) {
          try {
            await this.loadContent(content.id, content.file);
            loaded++;
            this.updateLoadingProgress(10 + (loaded / total) * 80);
          } catch (error) {
            console.warn(`Failed to load ${content.file}:`, error);
            // Create placeholder content
            document.getElementById(content.id).innerHTML = 
              `<div class="content-placeholder">Content loading... (${content.file})</div>`;
          }
        }
      }

      async loadContent(elementId, filePath) {
        if (this.loadedContent.has(filePath)) return;
        
        try {
          const response = await fetch(filePath);
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          
          const html = await response.text();
          const element = document.getElementById(elementId);
          if (element) {
            element.innerHTML = html;
            this.loadedContent.add(filePath);
            
            // Execute any scripts in the loaded content
            this.executeScripts(element);
          }
        } catch (error) {
          console.warn(`Failed to load ${filePath}:`, error);
          throw error;
        }
      }

      executeScripts(container) {
        const scripts = container.querySelectorAll('script');
        scripts.forEach(script => {
          const newScript = document.createElement('script');
          newScript.textContent = script.textContent;
          if (script.src) newScript.src = script.src;
          if (script.type) newScript.type = script.type;
          document.head.appendChild(newScript);
        });
      }

      setupModeSwitch() {
        const modeOptions = document.querySelectorAll('input[name="interface-mode"]');
        modeOptions.forEach(option => {
          option.addEventListener('change', (e) => {
            if (e.target.checked) {
              this.switchMode(e.target.value);
            }
          });
        });
      }

      switchMode(mode) {
        this.currentMode = mode;
        
        // Update interface visibility
        const interfaces = document.querySelectorAll('.interface-section');
        interfaces.forEach(section => {
          section.classList.remove('active');
        });
        document.getElementById(`${mode}-interface`).classList.add('active');
        
        // Update mode options
        const modeOptions = document.querySelectorAll('.mode-option');
        modeOptions.forEach(option => {
          option.classList.remove('active');
        });
        document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
        
        // Update stylesheets
        const predatoryStyles = document.getElementById('predatory-styles');
        const ethicalStyles = document.getElementById('ethical-styles');
        if (predatoryStyles && ethicalStyles) {
          predatoryStyles.disabled = mode === 'ethical';
          ethicalStyles.disabled = mode === 'predatory';
        }
        
        // Trigger analytics
        if (window.LotusAnalytics) {
          window.LotusAnalytics.trackModeSwitch(mode);
        }
        
        // Update terminal
        this.logToTerminal(`Mode switched to: ${mode}`);
      }

      setupTerminal() {
        const terminalToggle = document.getElementById('terminal-toggle');
        const terminalOverlay = document.getElementById('terminal-overlay');
        const terminalClose = document.getElementById('terminal-close');
        
        terminalToggle.addEventListener('click', () => {
          terminalOverlay.classList.toggle('hidden');
        });
        
        terminalClose.addEventListener('click', () => {
          terminalOverlay.classList.add('hidden');
        });
        
        // Initialize terminal with system info
        this.logToTerminal('System initialized');
        this.logToTerminal(`Current mode: ${this.currentMode}`);
        this.logToTerminal('All modules loaded successfully');
      }

      logToTerminal(message) {
        const terminalContent = document.getElementById('terminal-content');
        const timestamp = new Date().toLocaleTimeString();
        const line = document.createElement('div');
        line.className = 'terminal-line';
        line.textContent = `[${timestamp}] ${message}`;
        terminalContent.appendChild(line);
        terminalContent.scrollTop = terminalContent.scrollHeight;
      }

      initializeAnalytics() {
        // Initialize analytics overlay
        const analyticsData = document.getElementById('analytics-data');
        if (analyticsData) {
          analyticsData.innerHTML = `
            <div class="analytics-item">Mode: ${this.currentMode}</div>
            <div class="analytics-item">Load Time: ${Date.now() - window.loadStartTime}ms</div>
            <div class="analytics-item">Components: ${this.loadedContent.size}</div>
          `;
        }
      }

      updateLoadingProgress(percent) {
        const loadingBar = document.getElementById('loading-bar');
        if (loadingBar) {
          loadingBar.style.width = percent + '%';
        }
      }

      hideLoading() {
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
          loadingScreen.style.opacity = '0';
          setTimeout(() => {
            loadingScreen.style.display = 'none';
          }, 300);
        }
      }
    }

    // Track load start time
    window.loadStartTime = Date.now();
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        new LotusGitHubPagesLoader();
      });
    } else {
      new LotusGitHubPagesLoader();
    }
  </script>

  <style>
    /* Copilot: GitHub Pages specific styling */
    .mode-switcher-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      padding: 20px;
      z-index: 1000;
      min-width: 280px;
    }

    .mode-switcher-header h3 {
      margin: 0 0 5px 0;
      font-size: 16px;
      color: #333;
    }

    .mode-switcher-header p {
      margin: 0 0 15px 0;
      font-size: 12px;
      color: #666;
    }

    .mode-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }

    .mode-option {
      cursor: pointer;
      border-radius: 8px;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .mode-option input {
      display: none;
    }

    .mode-card {
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .mode-option.active .mode-card {
      border-color: #4CAF50;
      background: #f8fff8;
    }

    .predatory-option.active .mode-card {
      border-color: #f44336;
      background: #fff8f8;
    }

    .mode-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .mode-desc {
      font-size: 12px;
      color: #666;
    }

    .terminal-toggle {
      width: 100%;
      padding: 8px;
      background: #333;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }

    .terminal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .terminal-overlay.hidden {
      display: none;
    }

    .terminal-window {
      background: #1a1a1a;
      border-radius: 8px;
      width: 80%;
      max-width: 600px;
      max-height: 70%;
      overflow: hidden;
    }

    .terminal-header {
      background: #333;
      color: white;
      padding: 10px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .terminal-content {
      color: #00ff00;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      padding: 15px;
      height: 300px;
      overflow-y: auto;
    }

    .terminal-line {
      margin-bottom: 5px;
    }

    .interface-section {
      display: none;
    }

    .interface-section.active {
      display: block;
    }

    .analytics-overlay {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(0,0,0,0.9);
      color: white;
      padding: 15px;
      border-radius: 8px;
      font-size: 12px;
      z-index: 500;
    }

    .analytics-item {
      margin-bottom: 5px;
    }

    .content-placeholder {
      padding: 20px;
      text-align: center;
      color: #666;
      font-style: italic;
    }

    @media (max-width: 768px) {
      .mode-switcher-panel {
        position: relative;
        top: auto;
        right: auto;
        margin: 20px;
        width: calc(100% - 40px);
      }
      
      .terminal-window {
        width: 95%;
        margin: 20px;
      }
    }
  </style>
</body>
</html>
