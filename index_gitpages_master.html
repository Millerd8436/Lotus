<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotus - Payday Lending Educational Platform</title>
    <meta name="description" content="Interactive educational platform comparing predatory vs ethical lending practices. Learn about payday loan traps, dark patterns, and financial alternatives.">
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    <link rel="icon" type="image/png" href="images/lotus-icon.png">
    <link rel="apple-touch-icon" href="images/lotus-icon.png">
    
    <!-- CSS Framework -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="assets/global.css">
    
    <!-- Mode-specific Styles -->
    <style>
        /* Dynamic mode switching styles */
        body.mode-predatory {
            --primary-color: #dc3545;
            --accent-color: #ffc107;
            --urgency-color: #ff4757;
            --bg-color: #1a1a2e;
            --text-color: #ffffff;
        }
        
        body.mode-ethical {
            --primary-color: #28a745;
            --accent-color: #17a2b8;
            --urgency-color: #6c757d;
            --bg-color: #f8f9fa;
            --text-color: #333333;
        }
        
        /* Dynamic component visibility */
        .predatory-only { display: none; }
        .ethical-only { display: none; }
        
        body.mode-predatory .predatory-only { display: block; }
        body.mode-ethical .ethical-only { display: block; }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .grid-md-2 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body data-mode="predatory" class="mode-predatory">
    <!-- Navigation -->
    <nav class="bg-gray-900 text-white sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <img src="images/lotus-logo.png" alt="Lotus" class="h-8 w-8">
                    <h1 class="text-xl font-bold">Lotus Educational Platform</h1>
                </div>
                
                <!-- Mode Toggle -->
                <div class="flex items-center space-x-4">
                    <div class="mode-selector">
                        <label class="inline-flex items-center">
                            <input type="checkbox" id="mode-toggle" class="sr-only">
                            <div class="relative">
                                <div class="block bg-gray-600 w-14 h-8 rounded-full"></div>
                                <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"></div>
                            </div>
                            <span class="ml-3 text-sm">
                                <span class="predatory-only text-red-400">Predatory Mode</span>
                                <span class="ethical-only text-green-400">Ethical Mode</span>
                            </span>
                        </label>
                    </div>
                    
                    <!-- Navigation Menu -->
                    <div class="hidden md:flex space-x-4">
                        <a href="#home" class="hover:text-blue-400">Home</a>
                        <a href="#simulation" class="hover:text-blue-400">Simulation</a>
                        <a href="#education" class="hover:text-blue-400">Education</a>
                        <a href="#research" class="hover:text-blue-400">Research</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main id="main-content">
        <!-- Home Section -->
        <section id="home" class="min-h-screen">
            <!-- Predatory Hero -->
            <div class="predatory-only">
                <div id="predatory-hero-container"></div>
            </div>
            
            <!-- Ethical Hero -->
            <div class="ethical-only">
                <div id="ethical-hero-container"></div>
            </div>
        </section>

        <!-- Simulation Section -->
        <section id="simulation" class="min-h-screen bg-gray-100">
            <div class="container mx-auto px-4 py-16">
                <h2 class="text-3xl font-bold text-center mb-8">Interactive Loan Simulation</h2>
                
                <!-- Simulation Interface -->
                <div id="simulation-interface" class="max-w-4xl mx-auto">
                    <!-- Loan Application Form -->
                    <div class="predatory-only">
                        <div id="predatory-form-container"></div>
                    </div>
                    
                    <div class="ethical-only">
                        <div id="ethical-form-container"></div>
                    </div>
                    
                    <!-- APR Transparency Meter -->
                    <div id="apr-transparency-meter" class="mt-8"></div>
                    
                    <!-- Dark Pattern Detection -->
                    <div id="dark-pattern-flags" class="mt-8"></div>
                </div>
            </div>
        </section>

        <!-- Education Section -->
        <section id="education" class="min-h-screen bg-gray-900 text-white">
            <div class="container mx-auto px-4 py-16">
                <h2 class="text-3xl font-bold text-center mb-8">Educational Resources</h2>
                
                <!-- Educational Modules Grid -->
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">
                            <i class="fas fa-book mr-2"></i>
                            Usury Laws & Loopholes
                        </h3>
                        <p class="mb-4">Learn how predatory lenders circumvent state interest rate caps through legal loopholes.</p>
                        <button class="btn btn-primary" onclick="showEducationModule('usury')">
                            Learn More
                        </button>
                    </div>
                    
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">
                            <i class="fas fa-shield-alt mr-2"></i>
                            Dark Pattern Recognition
                        </h3>
                        <p class="mb-4">Identify UI manipulation tactics used to trap borrowers in debt cycles.</p>
                        <button class="btn btn-primary" onclick="showEducationModule('dark-patterns')">
                            Learn More
                        </button>
                    </div>
                    
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">
                            <i class="fas fa-calculator mr-2"></i>
                            True Cost Analysis
                        </h3>
                        <p class="mb-4">Calculate the real APR and total cost of payday loans vs alternatives.</p>
                        <button class="btn btn-primary" onclick="showEducationModule('cost-analysis')">
                            Learn More
                        </button>
                    </div>
                </div>
                
                <!-- Educational Content Display -->
                <div id="education-content" class="mt-12"></div>
            </div>
        </section>

        <!-- Research Section -->
        <section id="research" class="min-h-screen bg-blue-900 text-white">
            <div class="container mx-auto px-4 py-16">
                <h2 class="text-3xl font-bold text-center mb-8">Research & Analytics</h2>
                
                <!-- Research Dashboard -->
                <div id="research-dashboard" class="grid md:grid-cols-2 gap-8">
                    <div class="bg-blue-800 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Session Analytics</h3>
                        <div id="session-metrics"></div>
                    </div>
                    
                    <div class="bg-blue-800 p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Dark Pattern Detection</h3>
                        <div id="dark-pattern-metrics"></div>
                    </div>
                </div>
                
                <!-- Export Tools -->
                <div class="mt-8 text-center">
                    <button class="btn btn-secondary mr-4" onclick="exportResearchData('json')">
                        <i class="fas fa-download mr-2"></i>
                        Export JSON
                    </button>
                    <button class="btn btn-secondary" onclick="exportResearchData('csv')">
                        <i class="fas fa-file-csv mr-2"></i>
                        Export CSV
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Educational Overlay -->
    <div id="educational-overlay" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-4xl w-full max-h-full overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold">Educational Module</h2>
                        <button onclick="closeEducationalOverlay()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div id="education-module-content"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-4 gap-8">
                <div>
                    <h4 class="font-bold mb-4">About Lotus</h4>
                    <p class="text-sm">Educational platform for understanding predatory lending practices and promoting financial literacy.</p>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Resources</h4>
                    <ul class="text-sm space-y-2">
                        <li><a href="#" class="hover:text-blue-400">Consumer Protection</a></li>
                        <li><a href="#" class="hover:text-blue-400">Financial Alternatives</a></li>
                        <li><a href="#" class="hover:text-blue-400">State Regulations</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Research</h4>
                    <ul class="text-sm space-y-2">
                        <li><a href="#" class="hover:text-blue-400">Academic Papers</a></li>
                        <li><a href="#" class="hover:text-blue-400">Methodology</a></li>
                        <li><a href="#" class="hover:text-blue-400">Data Export</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-4">Contact</h4>
                    <p class="text-sm">This is an educational simulation. For real financial help, contact your local credit union or financial counselor.</p>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-sm">
                <p>&copy; 2024 Lotus Educational Platform. Built for research and education.</p>
            </div>
        </div>
    </footer>

    <!-- Core JavaScript Modules -->
    <script type="module" src="app.js"></script>
    <script type="module" src="ui.js"></script>
    <script type="module" src="assets/global.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
    
    <!-- Initialize Application -->
    <script>
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load mode-specific content
            loadModeContent();
            
            // Initialize components
            initializeComponents();
            
            // Setup mode toggle
            setupModeToggle();
            
            // Load educational modules
            loadEducationalModules();
        });
        
        function loadModeContent() {
            const mode = document.body.getAttribute('data-mode');
            
            if (mode === 'predatory') {
                loadPredatoryContent();
            } else {
                loadEthicalContent();
            }
        }
        
        function loadPredatoryContent() {
            // Load predatory hero
            fetch('predatory/hero.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('predatory-hero-container').innerHTML = html;
                });
                
            // Load predatory form
            fetch('predatory/form.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('predatory-form-container').innerHTML = html;
                });
        }
        
        function loadEthicalContent() {
            // Load ethical hero
            fetch('partials/ethical/hero.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('ethical-hero-container').innerHTML = html;
                });
                
            // Load ethical form
            fetch('partials/ethical/form-step1.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('ethical-form-container').innerHTML = html;
                });
        }
        
        function initializeComponents() {
            // Initialize APR Transparency Meter
            import('./ui_components/aprTransparencyMeter.js').then(module => {
                const meter = new module.APRTransparencyMeter();
                meter.initialize('apr-transparency-meter');
            });
            
            // Initialize Dark Pattern Flags
            import('./ui_components/darkPatternFlags.js').then(module => {
                window.darkPatternFlags = new module.DarkPatternFlags();
            });
            
            // Initialize Research Analytics
            import('./research/research_analytics.js').then(module => {
                window.researchAnalytics = new module.ResearchAnalytics();
                window.researchAnalytics.enableResearchMode();
            });
        }
        
        function setupModeToggle() {
            const modeToggle = document.getElementById('mode-toggle');
            modeToggle.addEventListener('change', function() {
                const newMode = this.checked ? 'ethical' : 'predatory';
                document.body.setAttribute('data-mode', newMode);
                document.body.className = `mode-${newMode}`;
                loadModeContent();
                
                // Track mode change
                if (window.LotusApp?.utils?.trackEvent) {
                    window.LotusApp.utils.trackEvent('mode_changed', {
                        new_mode: newMode,
                        timestamp: Date.now()
                    });
                }
            });
        }
        
        function loadEducationalModules() {
            // Educational modules will be loaded on demand
        }
        
        function showEducationModule(moduleType) {
            document.getElementById('educational-overlay').classList.remove('hidden');
            
            // Load specific educational content based on module type
            let moduleContent = '';
            switch(moduleType) {
                case 'usury':
                    moduleContent = generateUsuryEducationContent();
                    break;
                case 'dark-patterns':
                    moduleContent = generateDarkPatternEducationContent();
                    break;
                case 'cost-analysis':
                    moduleContent = generateCostAnalysisContent();
                    break;
            }
            
            document.getElementById('education-module-content').innerHTML = moduleContent;
        }
        
        function closeEducationalOverlay() {
            document.getElementById('educational-overlay').classList.add('hidden');
        }
        
        function generateUsuryEducationContent() {
            return `
                <h3 class="text-xl font-bold mb-4">Usury Laws & Legal Loopholes</h3>
                <div class="prose max-w-none">
                    <h4>What are Usury Laws?</h4>
                    <p>Usury laws set maximum interest rates that lenders can charge. However, payday lenders use several loopholes:</p>
                    
                    <h5>1. Fee vs Interest Distinction</h5>
                    <p>Many state usury laws only cap "interest" but not "fees." Lenders charge flat dollar amounts as "fees" instead of percentage rates.</p>
                    
                    <h5>2. Tribal Sovereignty</h5>
                    <p>Some lenders partner with Native American tribes to claim sovereign immunity from state laws.</p>
                    
                    <h5>3. Rent-a-Bank Schemes</h5>
                    <p>Partnerships with federally chartered banks allow lenders to "export" more permissive state laws nationwide.</p>
                    
                    <h5>4. Product Reclassification</h5>
                    <p>"Earned Wage Access" apps avoid lending regulations by framing advances as payroll services rather than loans.</p>
                    
                    <div class="bg-yellow-100 p-4 rounded mt-4">
                        <strong>Key Takeaway:</strong> Always calculate the true APR regardless of how fees are labeled.
                    </div>
                </div>
            `;
        }
        
        function generateDarkPatternEducationContent() {
            return `
                <h3 class="text-xl font-bold mb-4">Dark Pattern Recognition</h3>
                <div class="prose max-w-none">
                    <p>Dark patterns are UI/UX design techniques that manipulate users into making unintended decisions. In payday lending:</p>
                    
                    <h5>Common Dark Patterns:</h5>
                    <ul>
                        <li><strong>Fake Urgency:</strong> Countdown timers that reset to create false scarcity</li>
                        <li><strong>Hidden Costs:</strong> Important fees buried in fine print or multiple pages</li>
                        <li><strong>Pre-checked Boxes:</strong> Automatic consent to additional services or data sharing</li>
                        <li><strong>Social Proof Manipulation:</strong> Fake testimonials and fabricated user activity</li>
                        <li><strong>Misdirection:</strong> Prominent "benefits" while hiding risks and costs</li>
                    </ul>
                    
                    <h5>How to Protect Yourself:</h5>
                    <ul>
                        <li>Always read all terms before agreeing</li>
                        <li>Uncheck pre-selected boxes</li>
                        <li>Calculate true APR yourself</li>
                        <li>Be skeptical of "limited time" offers</li>
                        <li>Research lender reviews independently</li>
                    </ul>
                </div>
            `;
        }
        
        function generateCostAnalysisContent() {
            return `
                <h3 class="text-xl font-bold mb-4">True Cost Analysis</h3>
                <div class="prose max-w-none">
                    <h5>APR Calculation Formula:</h5>
                    <p><code>APR = (Fee ÷ Principal) × (365 ÷ Term Days) × 100</code></p>
                    
                    <h5>Example Calculations:</h5>
                    <div class="bg-red-100 p-4 rounded mb-4">
                        <strong>Payday Loan:</strong><br>
                        $100 loan + $15 fee for 14 days<br>
                        APR = (15 ÷ 100) × (365 ÷ 14) × 100 = <strong>391%</strong>
                    </div>
                    
                    <div class="bg-green-100 p-4 rounded mb-4">
                        <strong>Credit Union Alternative:</strong><br>
                        $100 loan at 18% APR for 12 months<br>
                        Total cost = <strong>$109</strong> (vs $115 for payday loan)
                    </div>
                    
                    <h5>Hidden Costs to Consider:</h5>
                    <ul>
                        <li>Rollover fees (when you can't repay on time)</li>
                        <li>NSF charges if your bank account has insufficient funds</li>
                        <li>Collection fees if you default</li>
                        <li>Credit score damage</li>
                    </ul>
                    
                    <div class="bg-blue-100 p-4 rounded mt-4">
                        <strong>Interactive Calculator:</strong> Use our cost comparison tool to see how different loan types affect your finances over time.
                    </div>
                </div>
            `;
        }
        
        function exportResearchData(format) {
            if (window.researchAnalytics) {
                if (format === 'json') {
                    window.researchAnalytics.exportToJSON();
                } else if (format === 'csv') {
                    window.researchAnalytics.exportToCSV();
                }
            }
        }
    </script>
</body>
</html>
