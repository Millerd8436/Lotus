<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotus Integration Test Suite</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 2rem;
            background: #f8f9fa;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #343a40;
            text-align: center;
            margin-bottom: 2rem;
        }
        .test-section {
            background: white;
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        .test-item {
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .test-item.success {
            border-color: #28a745;
            background: #f0fff4;
        }
        .test-item.error {
            border-color: #dc3545;
            background: #fff5f5;
        }
        .test-item.pending {
            border-color: #ffc107;
            background: #fff9e6;
        }
        .status {
            font-weight: bold;
            font-size: 0.9rem;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .pending { color: #ffc107; }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .results {
            margin-top: 2rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .summary {
            background: #e9ecef;
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            margin: 2rem 0;
        }
        .navigation-links {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }
        .nav-link {
            background: #6c757d;
            color: white;
            padding: 0.75rem 1.5rem;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        .nav-link:hover {
            background: #5a6268;
        }
        .nav-link.primary {
            background: #007bff;
        }
        .nav-link.primary:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå∏ Lotus Integration Test Suite</h1>
        <p style="text-align: center; color: #6c757d; font-size: 1.1rem;">
            Comprehensive verification of all 96+ files working together
        </p>

        <div class="navigation-links">
            <a href="index_master_integrated.html" class="nav-link primary">üöÄ Launch Master Integration</a>
            <a href="index.html" class="nav-link">üñ•Ô∏è Terminal Simulation</a>
            <a href="index_redirect.html" class="nav-link">‚ÜóÔ∏è Redirect Page</a>
        </div>

        <!-- File Existence Tests -->
        <div class="test-section">
            <h2>üìÅ File Existence Verification</h2>
            <p>Testing that all required files exist and are accessible</p>
            <button class="test-button" onclick="runFileTests()">Run File Tests</button>
            
            <div class="test-grid" id="file-tests">
                <!-- File test results will be populated here -->
            </div>
        </div>

        <!-- Partial Loading Tests -->
        <div class="test-section">
            <h2>üß© Partial Loading Tests</h2>
            <p>Verifying that HTML partials load correctly</p>
            <button class="test-button" onclick="runPartialTests()">Test Partial Loading</button>
            
            <div class="test-grid" id="partial-tests">
                <!-- Partial test results will be populated here -->
            </div>
        </div>

        <!-- Mode Switching Tests -->
        <div class="test-section">
            <h2>üîÑ Mode Switching Tests</h2>
            <p>Testing predatory/ethical mode functionality</p>
            <button class="test-button" onclick="runModeTests()">Test Mode Switching</button>
            
            <div class="test-grid" id="mode-tests">
                <!-- Mode test results will be populated here -->
            </div>
        </div>

        <!-- Integration Tests -->
        <div class="test-section">
            <h2>‚öôÔ∏è Integration Tests</h2>
            <p>Verifying that all components work together</p>
            <button class="test-button" onclick="runIntegrationTests()">Run Integration Tests</button>
            
            <div class="test-grid" id="integration-tests">
                <!-- Integration test results will be populated here -->
            </div>
        </div>

        <!-- Test Results Summary -->
        <div class="summary" id="test-summary" style="display: none;">
            <h2>üìä Test Results Summary</h2>
            <div id="summary-content"></div>
        </div>

        <div class="results" id="test-log" style="display: none;">
            <strong>Test Log:</strong><br>
            <div id="log-content"></div>
        </div>
    </div>

    <script>
        // Test configuration
        const requiredFiles = [
            'index_master_integrated.html',
            'app.js',
            'assets/global.css',
            'assets/global.js',
            'predatory/hero.html',
            'predatory/slider.html',
            'predatory/form.html',
            'predatory/faq.html',
            'predatory/trust-signals.html',
            'predatory/terms.html',
            'predatory/countdown.js',
            'predatory/styles.css',
            'ethical/hero.html',
            'ethical/form-step1.html',
            'ethical/form-step2.html',
            'ethical/apr-display.html',
            'ethical/education.html',
            'ethical/styles.css',
            'partials/ethical/alternatives.html',
            'partials/ethical/calculator.html',
            'partials/ethical/footer.html',
            'core/loan_core.js',
            'modes/exploitative.js',
            'modes/ethical.js',
            'engine/autonomy_theater.js',
            'engine/behavioralPsychology.js',
            'engine/echo.js',
            'engine/kant.js',
            'research/research_analytics.js',
            'ui_components/aprCalculator.js',
            'ui_components/darkPatternEngine.js'
        ];

        const partialFiles = [
            'predatory/hero.html',
            'predatory/slider.html',
            'predatory/form.html',
            'predatory/faq.html',
            'predatory/trust-signals.html',
            'predatory/terms.html',
            'ethical/hero.html',
            'ethical/form-step1.html',
            'ethical/form-step2.html',
            'ethical/apr-display.html',
            'ethical/education.html',
            'partials/ethical/alternatives.html',
            'partials/ethical/calculator.html',
            'partials/ethical/footer.html'
        ];

        let testResults = {
            files: {},
            partials: {},
            modes: {},
            integration: {}
        };

        function log(message) {
            const logContent = document.getElementById('log-content');
            const timestamp = new Date().toLocaleTimeString();
            logContent.innerHTML += `[${timestamp}] ${message}<br>`;
            document.getElementById('test-log').style.display = 'block';
        }

        async function runFileTests() {
            log('Starting file existence tests...');
            const container = document.getElementById('file-tests');
            container.innerHTML = '';

            for (const file of requiredFiles) {
                const testItem = document.createElement('div');
                testItem.className = 'test-item pending';
                testItem.innerHTML = `
                    <strong>${file}</strong><br>
                    <span class="status pending">Testing...</span>
                `;
                container.appendChild(testItem);

                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        testItem.className = 'test-item success';
                        testItem.querySelector('.status').innerHTML = '<span class="success">‚úÖ Exists</span>';
                        testResults.files[file] = true;
                        log(`‚úÖ ${file} - Found`);
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    testItem.className = 'test-item error';
                    testItem.querySelector('.status').innerHTML = `<span class="error">‚ùå Missing (${error.message})</span>`;
                    testResults.files[file] = false;
                    log(`‚ùå ${file} - ${error.message}`);
                }
                
                // Small delay to show progress
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            log('File existence tests completed');
            updateSummary();
        }

        async function runPartialTests() {
            log('Starting partial loading tests...');
            const container = document.getElementById('partial-tests');
            container.innerHTML = '';

            for (const file of partialFiles) {
                const testItem = document.createElement('div');
                testItem.className = 'test-item pending';
                testItem.innerHTML = `
                    <strong>${file}</strong><br>
                    <span class="status pending">Loading...</span>
                `;
                container.appendChild(testItem);

                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        const html = await response.text();
                        const hasContent = html.trim().length > 100; // Basic content check
                        const hasCopilotComment = html.includes('Copilot:');
                        
                        if (hasContent && hasCopilotComment) {
                            testItem.className = 'test-item success';
                            testItem.querySelector('.status').innerHTML = '<span class="success">‚úÖ Valid Partial</span>';
                            testResults.partials[file] = true;
                            log(`‚úÖ ${file} - Valid partial with Copilot comments`);
                        } else {
                            throw new Error('Invalid content or missing Copilot comments');
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    testItem.className = 'test-item error';
                    testItem.querySelector('.status').innerHTML = `<span class="error">‚ùå Failed (${error.message})</span>`;
                    testResults.partials[file] = false;
                    log(`‚ùå ${file} - ${error.message}`);
                }
                
                await new Promise(resolve => setTimeout(resolve, 150));
            }

            log('Partial loading tests completed');
            updateSummary();
        }

        async function runModeTests() {
            log('Starting mode switching tests...');
            const container = document.getElementById('mode-tests');
            container.innerHTML = '';

            const modeTests = [
                { name: 'Predatory Styles', file: 'predatory/styles.css' },
                { name: 'Ethical Styles', file: 'ethical/styles.css' },
                { name: 'Global Styles', file: 'assets/global.css' },
                { name: 'Global JavaScript', file: 'assets/global.js' }
            ];

            for (const test of modeTests) {
                const testItem = document.createElement('div');
                testItem.className = 'test-item pending';
                testItem.innerHTML = `
                    <strong>${test.name}</strong><br>
                    <span class="status pending">Testing...</span>
                `;
                container.appendChild(testItem);

                try {
                    const response = await fetch(test.file);
                    if (response.ok) {
                        const content = await response.text();
                        const hasRelevantContent = content.length > 500; // Basic content check
                        
                        if (hasRelevantContent) {
                            testItem.className = 'test-item success';
                            testItem.querySelector('.status').innerHTML = '<span class="success">‚úÖ Valid</span>';
                            testResults.modes[test.name] = true;
                            log(`‚úÖ ${test.name} - Content verified`);
                        } else {
                            throw new Error('Insufficient content');
                        }
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    testItem.className = 'test-item error';
                    testItem.querySelector('.status').innerHTML = `<span class="error">‚ùå Failed (${error.message})</span>`;
                    testResults.modes[test.name] = false;
                    log(`‚ùå ${test.name} - ${error.message}`);
                }
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            log('Mode switching tests completed');
            updateSummary();
        }

        async function runIntegrationTests() {
            log('Starting integration tests...');
            const container = document.getElementById('integration-tests');
            container.innerHTML = '';

            const integrationTests = [
                { 
                    name: 'Master Index', 
                    test: () => fetch('index_master_integrated.html').then(r => r.text().then(t => t.includes('switchInterface') && t.includes('switchMode')))
                },
                { 
                    name: 'App.js Module', 
                    test: () => fetch('app.js').then(r => r.text().then(t => t.includes('import') && t.includes('LoanCore')))
                },
                { 
                    name: 'Autonomy Theater', 
                    test: () => fetch('engine/autonomy_theater.js').then(r => r.ok)
                },
                { 
                    name: 'Behavioral Psychology', 
                    test: () => fetch('engine/behavioralPsychology.js').then(r => r.ok)
                },
                { 
                    name: 'Research Analytics', 
                    test: () => fetch('research/research_analytics.js').then(r => r.ok)
                },
                { 
                    name: 'APR Calculator', 
                    test: () => fetch('ui_components/aprCalculator.js').then(r => r.ok)
                }
            ];

            for (const test of integrationTests) {
                const testItem = document.createElement('div');
                testItem.className = 'test-item pending';
                testItem.innerHTML = `
                    <strong>${test.name}</strong><br>
                    <span class="status pending">Testing...</span>
                `;
                container.appendChild(testItem);

                try {
                    const result = await test.test();
                    if (result) {
                        testItem.className = 'test-item success';
                        testItem.querySelector('.status').innerHTML = '<span class="success">‚úÖ Integration OK</span>';
                        testResults.integration[test.name] = true;
                        log(`‚úÖ ${test.name} - Integration verified`);
                    } else {
                        throw new Error('Integration check failed');
                    }
                } catch (error) {
                    testItem.className = 'test-item error';
                    testItem.querySelector('.status').innerHTML = `<span class="error">‚ùå Failed (${error.message})</span>`;
                    testResults.integration[test.name] = false;
                    log(`‚ùå ${test.name} - ${error.message}`);
                }
                
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            log('Integration tests completed');
            updateSummary();
        }

        function updateSummary() {
            const summary = document.getElementById('test-summary');
            const content = document.getElementById('summary-content');
            
            const fileCount = Object.keys(testResults.files);
            const fileSuccess = Object.values(testResults.files).filter(Boolean).length;
            
            const partialCount = Object.keys(testResults.partials);
            const partialSuccess = Object.values(testResults.partials).filter(Boolean).length;
            
            const modeCount = Object.keys(testResults.modes);
            const modeSuccess = Object.values(testResults.modes).filter(Boolean).length;
            
            const integrationCount = Object.keys(testResults.integration);
            const integrationSuccess = Object.values(testResults.integration).filter(Boolean).length;

            content.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div>
                        <h3>üìÅ Files</h3>
                        <div style="font-size: 2rem; color: ${fileSuccess === fileCount.length ? '#28a745' : '#dc3545'};">
                            ${fileSuccess}/${fileCount.length}
                        </div>
                    </div>
                    <div>
                        <h3>üß© Partials</h3>
                        <div style="font-size: 2rem; color: ${partialSuccess === partialCount.length ? '#28a745' : '#dc3545'};">
                            ${partialSuccess}/${partialCount.length}
                        </div>
                    </div>
                    <div>
                        <h3>üîÑ Modes</h3>
                        <div style="font-size: 2rem; color: ${modeSuccess === modeCount.length ? '#28a745' : '#dc3545'};">
                            ${modeSuccess}/${modeCount.length}
                        </div>
                    </div>
                    <div>
                        <h3>‚öôÔ∏è Integration</h3>
                        <div style="font-size: 2rem; color: ${integrationSuccess === integrationCount.length ? '#28a745' : '#dc3545'};">
                            ${integrationSuccess}/${integrationCount.length}
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 2rem;">
                    <h3>Overall Status</h3>
                    <div style="font-size: 1.5rem; font-weight: bold;">
                        ${(fileSuccess + partialSuccess + modeSuccess + integrationSuccess)} / ${(fileCount.length + partialCount.length + modeCount.length + integrationCount.length)} Tests Passed
                    </div>
                </div>
            `;
            
            summary.style.display = 'block';
        }

        // Auto-run basic tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            log('Test suite initialized. Click buttons to run tests.');
        });
    </script>
</body>
</html>
