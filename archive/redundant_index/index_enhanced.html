<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Copilot: Enhanced version with advanced features and PWA support -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotus Payday Lending Simulation - Enhanced</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1a73e8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Lotus Simulation">
    
    <!-- SEO and Social Media -->
    <meta name="description" content="Interactive simulation comparing predatory vs ethical payday lending practices. Educational tool for financial literacy and consumer protection.">
    <meta name="keywords" content="payday loans, financial education, predatory lending, consumer protection, ethical lending">
    <meta property="og:title" content="Lotus Payday Lending Simulation">
    <meta property="og:description" content="Compare predatory vs ethical lending practices in this interactive simulation">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="assets/global.css" as="style">
    <link rel="preload" href="assets/global.js" as="script">
    <link rel="preload" href="app_optimized.js" as="script">
    
    <!-- DNS Prefetch for External Resources -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="assets/global.css">
    <link rel="stylesheet" href="style.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/favicon-16x16.png">
    <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png">
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
    
    <!-- Critical CSS for above-the-fold content -->
    <style>
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loading-content {
            text-align: center;
            color: white;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .hero-section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="spinner"></div>
            <h2>Loading Lotus Simulation</h2>
            <p>Preparing interactive experience...</p>
        </div>
    </div>
    
    <!-- Main Application Container -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Navigation Header -->
        <header class="main-header">
            <nav class="navbar">
                <div class="nav-brand">
                    <h1>ü™∑ Lotus</h1>
                    <span class="tagline">Payday Lending Simulation</span>
                </div>
                
                <div class="nav-controls">
                    <div class="mode-selector">
                        <button id="neutral-mode" class="mode-btn active" data-mode="neutral">
                            Compare Modes
                        </button>
                        <button id="predatory-mode" class="mode-btn" data-mode="predatory">
                            Predatory Experience
                        </button>
                        <button id="ethical-mode" class="mode-btn" data-mode="ethical">
                            Ethical Alternative
                        </button>
                    </div>
                    
                    <div class="accessibility-controls">
                        <button id="toggle-contrast" aria-label="Toggle high contrast">üé®</button>
                        <button id="toggle-animations" aria-label="Toggle animations">‚ö°</button>
                        <button id="reset-simulation" aria-label="Reset simulation">üîÑ</button>
                    </div>
                </div>
            </nav>
        </header>
        
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content">
                <h2>Understanding Payday Lending</h2>
                <p class="hero-subtitle">
                    Experience the difference between predatory practices and ethical alternatives
                </p>
                
                <div class="hero-stats">
                    <div class="stat">
                        <span class="stat-number">400%</span>
                        <span class="stat-label">Average APR</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">12M</span>
                        <span class="stat-label">Americans Affected</span>
                    </div>
                    <div class="stat">
                        <span class="stat-number">$9B</span>
                        <span class="stat-label">Annual Fees</span>
                    </div>
                </div>
                
                <div class="hero-actions">
                    <button class="cta-primary" onclick="startSimulation()">
                        Start Simulation
                    </button>
                    <button class="cta-secondary" onclick="showEducationalInfo()">
                        Learn More
                    </button>
                </div>
            </div>
        </section>
        
        <!-- Dynamic Content Area -->
        <main id="main-content" class="main-content">
            <!-- Mode-specific content will be dynamically loaded here -->
            <div id="comparison-view" class="comparison-container">
                <div class="comparison-header">
                    <h3>Compare Lending Approaches</h3>
                    <p>See the stark differences between predatory and ethical lending practices</p>
                </div>
                
                <div class="comparison-grid">
                    <div class="comparison-card predatory-preview">
                        <h4>Predatory Approach</h4>
                        <ul class="preview-features">
                            <li>‚ùå Hidden fees and terms</li>
                            <li>‚ùå Aggressive marketing tactics</li>
                            <li>‚ùå Debt trap mechanisms</li>
                            <li>‚ùå Misleading APR presentation</li>
                        </ul>
                        <button class="preview-btn" onclick="loadPredatoryMode()">
                            Experience This Approach
                        </button>
                    </div>
                    
                    <div class="comparison-card ethical-preview">
                        <h4>Ethical Alternative</h4>
                        <ul class="preview-features">
                            <li>‚úÖ Full transparency</li>
                            <li>‚úÖ Educational resources</li>
                            <li>‚úÖ Alternative options</li>
                            <li>‚úÖ Clear cost breakdown</li>
                        </ul>
                        <button class="preview-btn" onclick="loadEthicalMode()">
                            Explore This Approach
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Educational Sidebar -->
        <aside id="educational-panel" class="educational-panel">
            <div class="panel-header">
                <h3>üìö Educational Resources</h3>
                <button id="toggle-panel" aria-label="Toggle educational panel">√ó</button>
            </div>
            
            <div class="panel-content">
                <div class="resource-section">
                    <h4>Understanding APR</h4>
                    <p>Annual Percentage Rate includes all costs of borrowing...</p>
                    <button class="resource-btn">Learn More</button>
                </div>
                
                <div class="resource-section">
                    <h4>Alternatives to Payday Loans</h4>
                    <ul>
                        <li>Credit union loans</li>
                        <li>Payment plans with creditors</li>
                        <li>Emergency assistance programs</li>
                    </ul>
                </div>
                
                <div class="resource-section">
                    <h4>Red Flags to Watch For</h4>
                    <ul>
                        <li>No credit check required</li>
                        <li>Guaranteed approval claims</li>
                        <li>Pressure to decide quickly</li>
                        <li>Unclear fee structure</li>
                    </ul>
                </div>
            </div>
        </aside>
        
        <!-- Analytics Dashboard (Development Mode) -->
        <div id="analytics-dashboard" class="analytics-dashboard" style="display: none;">
            <h4>üìä Interaction Analytics</h4>
            <div class="analytics-grid">
                <div class="metric">
                    <span class="metric-label">Clicks</span>
                    <span id="click-count" class="metric-value">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Time Spent</span>
                    <span id="time-spent" class="metric-value">0s</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Mode Switches</span>
                    <span id="mode-switches" class="metric-value">0</span>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="main-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Disclaimer</h4>
                    <p>This is an educational simulation. Not actual lending services.</p>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#" onclick="showConsumerProtection()">Consumer Protection</a></li>
                        <li><a href="#" onclick="showStateRegulations()">State Regulations</a></li>
                        <li><a href="#" onclick="showCreditCounseling()">Credit Counseling</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Technical</h4>
                    <p>Built with vanilla JavaScript for maximum compatibility</p>
                    <button onclick="showPerformanceMetrics()">Performance Metrics</button>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- Performance Monitoring -->
    <script>
        // Track page load performance
        window.addEventListener('load', () => {
            const loadTime = performance.now();
            console.log(`Page loaded in ${loadTime.toFixed(2)}ms`);
            
            // Hide loading screen
            const loadingScreen = document.getElementById('loading-screen');
            const app = document.getElementById('app');
            
            setTimeout(() => {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    app.style.display = 'block';
                }, 500);
            }, 1000);
        });
        
        // Enhanced mode switching
        function startSimulation() {
            document.getElementById('comparison-view').scrollIntoView({
                behavior: 'smooth'
            });
        }
        
        function loadPredatoryMode() {
            window.location.href = '?mode=predatory';
        }
        
        function loadEthicalMode() {
            window.location.href = '?mode=ethical';
        }
        
        function showEducationalInfo() {
            const panel = document.getElementById('educational-panel');
            panel.classList.toggle('active');
        }
        
        function showPerformanceMetrics() {
            if (window.Lotus && window.Lotus.app) {
                const metrics = window.Lotus.app.getPerformanceMetrics();
                console.table(metrics);
                alert('Performance metrics logged to console');
            }
        }
        
        function showConsumerProtection() {
            window.open('https://www.consumerfinance.gov/consumer-tools/payday-loans/', '_blank');
        }
        
        function showStateRegulations() {
            alert('State-specific regulations would be shown here based on user location');
        }
        
        function showCreditCounseling() {
            window.open('https://www.nfcc.org/', '_blank');
        }
    </script>
    
    <!-- Core Application Scripts -->
    <script src="assets/global.js"></script>
    <script src="app_optimized.js"></script>
    
    <!-- Development Tools (remove in production) -->
    <script>
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            document.getElementById('analytics-dashboard').style.display = 'block';
            
            // Enable debug mode
            window.DEBUG = true;
            console.log('üîß Development mode enabled');
        }
    </script>
</body>
</html>