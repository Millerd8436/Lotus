<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Copilot: 73-file scaffold main index with all existing Lotus content preserved -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lotus Payday Loan Simulator</title>
  <link rel="stylesheet" href="assets/global.css">
  <link rel="stylesheet" href="predatory/styles.css" id="pred-styles">
  <link rel="stylesheet" href="ethical/styles.css" id="eth-styles" disabled>
</head>
<body>
  <!-- Mode Switch Controller -->
  <div class="mode-controller">
    <label class="mode-switch-label">
      <input type="checkbox" id="mode-switch"> 
      <span class="switch-text">Ethical Redesign Mode</span>
    </label>
    <div class="mode-info">
      <span id="current-mode-display">Predatory Mode Active</span>
    </div>
  </div>

  <!-- Predatory UI Include -->
  <section id="predatory-ui">
    <!-- Copilot: include predatory/hero.html here -->
    <div id="predatory-hero-include" class="include-container"></div>
    
    <!-- Copilot: include predatory/slider.html here -->
    <div id="predatory-slider-include" class="include-container"></div>
    
    <!-- Copilot: include predatory/form.html here -->
    <div id="predatory-form-include" class="include-container"></div>
    
    <!-- Copilot: include predatory/faq.html here -->
    <div id="predatory-faq-include" class="include-container"></div>
    
    <!-- Copilot: include predatory/trust-signals.html here -->
    <div id="predatory-trust-signals-include" class="include-container"></div>
    
    <!-- Copilot: include predatory/terms.html here -->
    <div id="predatory-terms-include" class="include-container"></div>
  </section>

  <!-- Ethical UI Include -->
  <section id="ethical-ui" style="display:none;">
    <!-- Copilot: include ethical/hero.html here -->
    <div id="ethical-hero-include" class="include-container"></div>
    
    <!-- Copilot: include ethical/form-step1.html here -->
    <div id="ethical-form-step1-include" class="include-container"></div>
    
    <!-- Copilot: include ethical/form-step2.html here -->
    <div id="ethical-form-step2-include" class="include-container"></div>
    
    <!-- Copilot: include ethical/apr-display.html here -->
    <div id="ethical-apr-display-include" class="include-container"></div>
    
    <!-- Copilot: include ethical/education.html here -->
    <div id="ethical-education-include" class="include-container"></div>
  </section>

  <!-- Terminal Simulation Integration (Preserved from original) -->
  <div id="terminal-simulation" class="terminal-overlay hidden">
    <div class="terminal-header">
      <h2>üå∏ Lotus + Autonomy Theater Terminal</h2>
      <button onclick="toggleTerminal()" class="close-terminal">√ó</button>
    </div>
    <div class="terminal-content">
      <pre id="terminal-output">Lotus Autonomy Theater Integration Ready...</pre>
      <div class="terminal-input">
        <input type="text" id="terminal-command" placeholder="Enter command...">
        <button onclick="executeCommand()">Execute</button>
      </div>
    </div>
  </div>

  <!-- Floating Terminal Access -->
  <button id="terminal-toggle" onclick="toggleTerminal()" class="floating-terminal-btn">
    üñ•Ô∏è Terminal
  </button>

  <!-- Scripts in correct order -->
  <script src="assets/global.js" type="module"></script>
  <script src="predatory/countdown.js" type="module"></script>
  
  <!-- Include loading system for GitHub Pages -->
  <script>
    // Copilot: GitHub Pages compatible include system
    async function loadIncludes() {
      const includes = [
        // Predatory includes
        { container: 'predatory-hero-include', file: 'predatory/hero.html' },
        { container: 'predatory-slider-include', file: 'predatory/slider.html' },
        { container: 'predatory-form-include', file: 'predatory/form.html' },
        { container: 'predatory-faq-include', file: 'predatory/faq.html' },
        { container: 'predatory-trust-signals-include', file: 'predatory/trust-signals.html' },
        { container: 'predatory-terms-include', file: 'predatory/terms.html' },
        
        // Ethical includes
        { container: 'ethical-hero-include', file: 'ethical/hero.html' },
        { container: 'ethical-form-step1-include', file: 'ethical/form-step1.html' },
        { container: 'ethical-form-step2-include', file: 'ethical/form-step2.html' },
        { container: 'ethical-apr-display-include', file: 'ethical/apr-display.html' },
        { container: 'ethical-education-include', file: 'ethical/education.html' }
      ];

      for (const include of includes) {
        try {
          const response = await fetch(include.file);
          if (response.ok) {
            const html = await response.text();
            const container = document.getElementById(include.container);
            if (container) {
              container.innerHTML = html;
              
              // Execute any inline scripts
              const scripts = container.querySelectorAll('script');
              scripts.forEach(script => {
                const newScript = document.createElement('script');
                if (script.src) {
                  newScript.src = script.src;
                } else {
                  newScript.textContent = script.textContent;
                }
                document.head.appendChild(newScript);
              });
            }
          }
        } catch (error) {
          console.warn(`Failed to load ${include.file}:`, error);
        }
      }
    }

    // Mode switching (preserved from original spec)
    function initializeModeSwitch() {
      const switchEl = document.getElementById('mode-switch');
      const predStyles = document.getElementById('pred-styles');
      const ethStyles = document.getElementById('eth-styles');
      const modeDisplay = document.getElementById('current-mode-display');
      
      if (switchEl) {
        switchEl.addEventListener('change', () => {
          const ethical = switchEl.checked;
          const predatoryUI = document.getElementById('predatory-ui');
          const ethicalUI = document.getElementById('ethical-ui');
          
          if (predatoryUI && ethicalUI) {
            predatoryUI.style.display = ethical ? 'none' : 'block';
            ethicalUI.style.display = ethical ? 'block' : 'none';
          }
          
          if (predStyles && ethStyles) {
            predStyles.disabled = ethical;
            ethStyles.disabled = !ethical;
          }
          
          if (modeDisplay) {
            modeDisplay.textContent = ethical ? 'Ethical Mode Active' : 'Predatory Mode Active';
          }
          
          // Update global app state
          if (window.LotusApp) {
            window.LotusApp.currentMode = ethical ? 'ethical' : 'predatory';
          }
        });
      }
    }

    // Terminal integration (preserving autonomy theater)
    function toggleTerminal() {
      const terminal = document.getElementById('terminal-simulation');
      if (terminal) {
        terminal.classList.toggle('hidden');
        if (!terminal.classList.contains('hidden')) {
          initializeTerminalIntegration();
        }
      }
    }

    function executeCommand() {
      const input = document.getElementById('terminal-command');
      const output = document.getElementById('terminal-output');
      
      if (input && output) {
        const command = input.value.trim();
        output.textContent += `\n> ${command}`;
        
        // Process terminal commands (preserved from original)
        processTerminalCommand(command, output);
        
        input.value = '';
        output.scrollTop = output.scrollHeight;
      }
    }

    function processTerminalCommand(command, output) {
      switch(command.toLowerCase()) {
        case 'autonomy':
          output.textContent += '\nAutonomy Theater: Analyzing choice architecture...';
          if (window.LotusApp) {
            window.LotusApp.analytics.interactions++;
          }
          break;
        case 'ethics':
          output.textContent += '\nEthical Framework: Running Kantian analysis...';
          break;
        case 'behavior':
          output.textContent += '\nBehavioral Psychology: Tracking manipulation patterns...';
          break;
        case 'help':
          output.textContent += '\nCommands: autonomy, ethics, behavior, research, ghost, clear';
          break;
        case 'clear':
          output.textContent = 'Lotus Autonomy Theater Integration Ready...';
          break;
        default:
          output.textContent += `\nUnknown command: ${command}. Type 'help' for commands.`;
      }
    }

    function initializeTerminalIntegration() {
      // Connect to existing autonomy theater system
      if (window.LotusApp && window.LotusApp.simulation) {
        document.getElementById('terminal-output').textContent += '\nConnected to Autonomy Theater System...';
      }
    }

    // Initialize everything when DOM is ready
    document.addEventListener('DOMContentLoaded', async function() {
      await loadIncludes();
      initializeModeSwitch();
      
      // Connect to existing Lotus app if available
      if (window.LotusApp) {
        window.LotusApp.currentInterface = 'scaffold';
        console.log('Lotus 73-file scaffold initialized with full integration');
      }
    });
  </script>

  <!-- Additional CSS for scaffold integration -->
  <style>
    /* Copilot: 73-file scaffold integration styles */
    .mode-controller {
      position: fixed;
      top: 20px;
      right: 20px;
      background: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      border: 2px solid #e9ecef;
    }

    .mode-switch-label {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      cursor: pointer;
    }

    .mode-info {
      margin-top: 8px;
      font-size: 0.85rem;
      color: #6c757d;
      text-align: center;
    }

    .include-container {
      margin: 0;
      padding: 0;
    }

    .terminal-overlay {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      max-width: 800px;
      height: 60%;
      background: #1a1a1a;
      color: #00ff00;
      border-radius: 10px;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      font-family: 'Courier New', monospace;
    }

    .terminal-overlay.hidden {
      display: none;
    }

    .terminal-header {
      background: #333;
      padding: 10px 20px;
      border-radius: 10px 10px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
    }

    .close-terminal {
      background: #ff4444;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
    }

    .terminal-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }

    #terminal-output {
      flex: 1;
      background: transparent;
      border: none;
      color: #00ff00;
      font-family: inherit;
      font-size: 14px;
      overflow-y: auto;
      margin-bottom: 15px;
      white-space: pre-wrap;
    }

    .terminal-input {
      display: flex;
      gap: 10px;
    }

    #terminal-command {
      flex: 1;
      background: #333;
      border: 1px solid #555;
      color: #00ff00;
      padding: 8px 12px;
      font-family: inherit;
      border-radius: 4px;
    }

    .floating-terminal-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,123,255,0.3);
      z-index: 999;
      transition: all 0.3s ease;
    }

    .floating-terminal-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,123,255,0.4);
    }

    @media (max-width: 768px) {
      .mode-controller {
        position: relative;
        top: auto;
        right: auto;
        margin: 20px;
        width: calc(100% - 40px);
      }

      .terminal-overlay {
        width: 95%;
        height: 70%;
      }
    }
  </style>
</body>
</html>
