<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Copilot: do not overwrite - Master GitHub Pages integration preserving all 122 files -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lotus Payday Loan Simulator - Complete Educational Platform</title>
  
  <!-- Global Assets -->
  <link rel="stylesheet" href="assets/global.css">
  <link rel="stylesheet" href="style.css">
  
  <!-- Mode-specific stylesheets (switched via JavaScript) -->
  <link rel="stylesheet" href="predatory/styles.css" id="pred-styles">
  <link rel="stylesheet" href="ethical/styles.css" id="eth-styles" disabled>
  
  <!-- PWA and SEO -->
  <meta name="description" content="Educational simulation platform comparing predatory vs ethical payday lending with full autonomy theater integration">
  <meta name="theme-color" content="#667eea">
  <link rel="icon" href="favicon.ico">
  
  <!-- Tailwind CSS for simulation interface -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Alpine.js for interactivity -->
  <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.x.x/dist/alpine.min.js" defer></script>
</head>
<body>
  <!-- Mode Switch Controls -->
  <div class="mode-controls">
    <label class="mode-switch">
      <input type="checkbox" id="mode-switch">
      <span class="slider"></span>
      <span class="mode-label">Ethical Redesign</span>
    </label>
    
    <label class="interface-switch">
      <input type="checkbox" id="interface-switch">
      <span class="slider"></span>
      <span class="interface-label">UI Experience</span>
    </label>
  </div>

  <!-- Terminal Simulation Interface (Preserved completely) -->
  <div id="simulation-interface" class="interface-container active">
    <div class="bg-gray-900 text-gray-200 font-mono antialiased min-h-screen">
      <div id="container" class="max-w-5xl mx-auto p-4 md:p-8">
        <header role="banner" class="text-center mb-10">
          <h1 class="text-4xl font-bold text-purple-400">Lotus + Autonomy Theater</h1>
          <p class="text-gray-400 mt-2 text-lg">An Interactive Simulation of Choice, Consent, and Coercion</p>
        </header>

        <!-- Urgency Banner for Exploitative Mode -->
        <div id="urgency-banner" class="hidden bg-red-800 border-2 border-red-500 text-center p-3 rounded-lg mb-6 shadow-lg animate-pulse">
          <p class="text-lg font-bold text-yellow-300">
            ðŸ”¥ INSTANT APPROVAL! <span id="timer">05:00</span> LEFT TO LOCK IN YOUR SPECIAL RATE! ðŸ”¥
          </p>
        </div>

        <main role="main">
          <!-- Section for simulation controls -->
          <section id="controls" aria-labelledby="controls-heading" class="mb-8 p-6 bg-gray-800 rounded-xl shadow-2xl border border-gray-700">
            <h2 id="controls-heading" class="text-2xl font-semibold text-center text-purple-300 mb-6">Simulation Setup</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 items-end">
              <div class="flex flex-col">
                <label for="state-input" class="mb-2 text-sm font-medium text-gray-400">State (e.g., CO, TX)</label>
                <input type="text" id="state-input" placeholder="State Abbr." class="bg-gray-700 border border-gray-600 rounded-lg p-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition">
              </div>
              <div class="flex flex-col">
                <label for="amount-input" class="mb-2 text-sm font-medium text-gray-400">Loan Amount ($)</label>
                <input type="number" id="amount-input" placeholder="e.g., 500" class="bg-gray-700 border border-gray-600 rounded-lg p-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition">
              </div>
              <div class="flex flex-col">
                <label for="term-input" class="mb-2 text-sm font-medium text-gray-400">Loan Term (days)</label>
                <input type="number" id="term-input" placeholder="e.g., 14" class="bg-gray-700 border border-gray-600 rounded-lg p-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition">
              </div>
              <div class="flex flex-col">
                <label for="scenario-select" class="mb-2 text-sm font-medium text-gray-400">Empathy Scenario</label>
                <select id="scenario-select" class="bg-gray-700 border border-gray-600 rounded-lg p-2 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition">
                  <option value="">-- Select a Scenario --</option>
                  <option value="singleparent">Single Parent, Car Repair</option>
                  <option value="tempworker">Gig Worker, Medical Bill</option>
                </select>
              </div>
            </div>
            <div class="mode-selection mt-8 text-center">
              <p class="mb-4 font-semibold text-lg">Choose a simulation mode:</p>
              <div class="flex justify-center gap-6 flex-wrap">
                <button id="start-regulated" class="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-400">
                  Ethical & Regulated Simulation
                </button>
                <button id="start-exploit" class="bg-red-600 hover:bg-red-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-400">
                  Exploitative Simulation
                </button>
              </div>
            </div>
          </section>

          <!-- Container for the live simulation output and input -->
          <section id="simContainer" aria-labelledby="simulation-heading" class="mb-8">
            <h2 id="simulation-heading" class="sr-only">Simulation Output</h2>
            <pre id="output" class="bg-black p-6 rounded-t-lg min-h-[350px] max-h-[60vh] overflow-y-auto whitespace-pre-wrap break-words font-mono text-sm border-2 border-gray-700 border-b-0">Welcome! Please configure your simulation and select a mode to begin.</pre>
            <div id="input-area" style="display: none;" class="flex">
              <input type="text" id="user-input" placeholder="Enter your response here..." class="flex-grow bg-gray-800 border-2 border-gray-700 p-3 rounded-bl-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
              <button id="submit-input" class="bg-purple-600 hover:bg-purple-500 text-white font-bold p-3 rounded-br-lg transition">Submit</button>
            </div>
          </section>

          <!-- Hidden pane for end-of-session reflection -->
          <section id="reflectionPane" x-data="{ tab: 'behavior' }" aria-labelledby="reflection-heading" class="hidden mt-10 p-6 bg-gray-800 rounded-xl shadow-2xl border border-gray-700">
            <h2 id="reflection-heading" class="text-2xl font-semibold text-center text-purple-300 mb-6">Ethical Reflection & Analysis</h2>

            <!-- Tab Navigation -->
            <div class="border-b border-gray-600">
              <nav class="-mb-px flex justify-center space-x-8" aria-label="Tabs">
                <button @click="tab = 'behavior'" :class="{ 'border-purple-400 text-purple-300': tab === 'behavior', 'border-transparent text-gray-500 hover:text-gray-300 hover:border-gray-400': tab !== 'behavior' }" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base focus:outline-none transition-colors">
                  Behavioral Analysis
                </button>
                <button @click="tab = 'ethics'" :class="{ 'border-purple-400 text-purple-300': tab === 'ethics', 'border-transparent text-gray-500 hover:text-gray-300 hover:border-gray-400': tab !== 'ethics' }" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base focus:outline-none transition-colors">
                  Ethical Report
                </button>
              </nav>
            </div>

            <div id="reflection-content" class="mt-6 space-y-6">
              <!-- Always visible: Consent Score -->
              <div class="p-4 bg-gray-700 rounded-lg">
                <h3 class="font-bold text-lg">Informed Consent Score:</h3>
                <div class="w-full bg-gray-600 rounded-full h-5 mt-2">
                  <div id="consent-bar" class="bg-green-500 h-5 rounded-full transition-all duration-500" style="width: 0%;"></div>
                </div>
              </div>

              <!-- Tab Panels -->
              <div x-show="tab === 'behavior'" id="behaviorSummary" class="p-5 bg-gray-700 rounded-lg">
                <p>Awaiting session data...</p>
              </div>
              <div x-show="tab === 'ethics'" id="autonomyScore" class="p-5 bg-gray-700 rounded-lg">
                <p>Calculating...</p>
              </div>
              
              <div id="ghostMessage" class="p-4 bg-gray-900 border border-dashed border-red-500 rounded-lg">
                <h3 class="font-bold text-lg text-red-400">A Voice in the Machine:</h3>
                <p class="italic mt-1">Ghost's commentary appears in the main simulation console above.</p>
              </div>
            </div>

            <div class="mt-8 text-center">
              <button id="emailReportBtn" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded-lg transition-transform transform hover:scale-105">
                Generate Follow-up Email
              </button>
              <button id="downloadLogBtn" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg ml-4 transition-transform transform hover:scale-105">
                Download Session Log (JSON)
              </button>
              <button id="replayBtn" class="bg-purple-600 hover:bg-purple-500 text-white font-bold py-2 px-4 rounded-lg ml-4 transition-transform transform hover:scale-105">
                Replay Simulation
              </button>
            </div>
          </section>
        </main>

        <footer role="contentinfo" class="text-center mt-16 text-gray-500 text-sm">
          <p>This was a simulation. These were not real choices.</p>
          <p class="mt-1">Lotus + Autonomy Theater Capstone Project</p>
        </footer>
      </div>
    </div>
  </div>

  <!-- UI Interface with all preserved content -->
  <div id="ui-interface" class="interface-container">
    <!-- Predatory UI Section -->
    <section id="predatory-ui" class="ui-section active">
      <!-- Copilot: include predatory/hero.html here -->
      <div id="predatory-hero-content"></div>
      
      <!-- Copilot: include predatory/slider.html here -->
      <div id="predatory-slider-content"></div>
      
      <!-- Copilot: include predatory/form.html here -->
      <div id="predatory-form-content"></div>
      
      <!-- Copilot: include predatory/faq.html here -->
      <div id="predatory-faq-content"></div>
      
      <!-- Copilot: include predatory/trust-signals.html here -->
      <div id="predatory-trust-signals-content"></div>
      
      <!-- Copilot: include predatory/terms.html here -->
      <div id="predatory-terms-content"></div>
    </section>

    <!-- Ethical UI Section -->
    <section id="ethical-ui" class="ui-section" style="display:none;">
      <!-- Copilot: include ethical/hero.html here -->
      <div id="ethical-hero-content"></div>
      
      <!-- Copilot: include ethical/form-step1.html here -->
      <div id="ethical-form-step1-content"></div>
      
      <!-- Copilot: include ethical/form-step2.html here -->
      <div id="ethical-form-step2-content"></div>
      
      <!-- Copilot: include ethical/apr-display.html here -->
      <div id="ethical-apr-display-content"></div>
      
      <!-- Copilot: include ethical/education.html here -->
      <div id="ethical-education-content"></div>
      
      <!-- Include ethical partials -->
      <div id="ethical-alternatives-content"></div>
      <div id="ethical-calculator-content"></div>
      <div id="ethical-footer-content"></div>
    </section>
  </div>

  <!-- Load all JavaScript modules -->
  <script src="assets/global.js"></script>
  <script src="predatory/countdown.js"></script>
  <script type="module" src="app.js"></script>
  
  <!-- Master integration script -->
  <script>
    // Copilot: do not overwrite - Master integration preserving all functionality
    
    // Global state management
    window.LotusApp = window.LotusApp || {};
    
    // Interface and mode switching
    let currentInterface = 'simulation'; // 'simulation' or 'ui'
    let currentMode = 'predatory'; // 'predatory' or 'ethical'
    let partialsLoaded = false;
    
    // HTML content to load for each section
    const contentSections = {
      predatory: [
        { id: 'predatory-hero-content', file: 'predatory/hero.html' },
        { id: 'predatory-slider-content', file: 'predatory/slider.html' },
        { id: 'predatory-form-content', file: 'predatory/form.html' },
        { id: 'predatory-faq-content', file: 'predatory/faq.html' },
        { id: 'predatory-trust-signals-content', file: 'predatory/trust-signals.html' },
        { id: 'predatory-terms-content', file: 'predatory/terms.html' }
      ],
      ethical: [
        { id: 'ethical-hero-content', file: 'ethical/hero.html' },
        { id: 'ethical-form-step1-content', file: 'ethical/form-step1.html' },
        { id: 'ethical-form-step2-content', file: 'ethical/form-step2.html' },
        { id: 'ethical-apr-display-content', file: 'ethical/apr-display.html' },
        { id: 'ethical-education-content', file: 'ethical/education.html' },
        { id: 'ethical-alternatives-content', file: 'partials/ethical/alternatives.html' },
        { id: 'ethical-calculator-content', file: 'partials/ethical/calculator.html' },
        { id: 'ethical-footer-content', file: 'partials/ethical/footer.html' }
      ]
    };
    
    // Load HTML content dynamically
    async function loadContent(sections) {
      const promises = sections.map(async (section) => {
        try {
          const response = await fetch(section.file);
          if (response.ok) {
            const html = await response.text();
            const container = document.getElementById(section.id);
            if (container) {
              container.innerHTML = html;
              
              // Execute any inline scripts
              const scripts = container.querySelectorAll('script');
              scripts.forEach(script => {
                const newScript = document.createElement('script');
                newScript.textContent = script.textContent;
                if (script.src) newScript.src = script.src;
                document.head.appendChild(newScript);
              });
            }
          }
        } catch (error) {
          console.error(`Error loading ${section.file}:`, error);
        }
      });
      
      await Promise.all(promises);
    }
    
    // Interface switching
    function switchInterface(newInterface) {
      const simInterface = document.getElementById('simulation-interface');
      const uiInterface = document.getElementById('ui-interface');
      
      if (newInterface === 'simulation') {
        simInterface.classList.add('active');
        uiInterface.classList.remove('active');
        currentInterface = 'simulation';
      } else {
        simInterface.classList.remove('active');
        uiInterface.classList.add('active');
        currentInterface = 'ui';
        
        // Load partials if not already loaded
        if (!partialsLoaded) {
          loadAllPartials();
          partialsLoaded = true;
        }
      }
    }
    
    // Mode switching
    function switchMode(newMode) {
      const predatoryUI = document.getElementById('predatory-ui');
      const ethicalUI = document.getElementById('ethical-ui');
      const predStyles = document.getElementById('pred-styles');
      const ethStyles = document.getElementById('eth-styles');
      
      if (newMode === 'predatory') {
        predatoryUI.style.display = 'block';
        ethicalUI.style.display = 'none';
        predStyles.disabled = false;
        ethStyles.disabled = true;
        currentMode = 'predatory';
      } else {
        predatoryUI.style.display = 'none';
        ethicalUI.style.display = 'block';
        predStyles.disabled = true;
        ethStyles.disabled = false;
        currentMode = 'ethical';
      }
      
      // Update global state
      if (window.LotusApp) {
        window.LotusApp.currentMode = newMode;
      }
    }
    
    // Load all partials
    async function loadAllPartials() {
      await Promise.all([
        loadContent(contentSections.predatory),
        loadContent(contentSections.ethical)
      ]);
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Interface switching
      const interfaceSwitch = document.getElementById('interface-switch');
      interfaceSwitch.addEventListener('change', function() {
        switchInterface(this.checked ? 'ui' : 'simulation');
      });
      
      // Mode switching
      const modeSwitch = document.getElementById('mode-switch');
      modeSwitch.addEventListener('change', function() {
        switchMode(this.checked ? 'ethical' : 'predatory');
      });
      
      // Initialize default state
      switchInterface('simulation');
      switchMode('predatory');
    });
  </script>
  
  <!-- Custom styles for the integration -->
  <style>
    /* Mode controls */
    .mode-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem;
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .mode-switch, .interface-switch {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      font-weight: 600;
    }
    
    /* Interface containers */
    .interface-container {
      display: none;
      min-height: 100vh;
    }
    
    .interface-container.active {
      display: block;
    }
    
    .ui-section {
      width: 100%;
    }
    
    /* Toggle switch styling */
    .mode-switch input[type="checkbox"],
    .interface-switch input[type="checkbox"] {
      position: relative;
      width: 40px;
      height: 20px;
      appearance: none;
      background: #ccc;
      border-radius: 10px;
      transition: background 0.3s;
      cursor: pointer;
    }
    
    .mode-switch input[type="checkbox"]:checked,
    .interface-switch input[type="checkbox"]:checked {
      background: #007bff;
    }
    
    .mode-switch input[type="checkbox"]::before,
    .interface-switch input[type="checkbox"]::before {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 16px;
      height: 16px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }
    
    .mode-switch input[type="checkbox"]:checked::before,
    .interface-switch input[type="checkbox"]:checked::before {
      transform: translateX(20px);
    }
    
    /* Responsive design */
    @media (max-width: 768px) {
      .mode-controls {
        top: 10px;
        right: 10px;
        padding: 0.75rem;
        font-size: 0.8rem;
      }
    }
  </style>
</body>
</html>
