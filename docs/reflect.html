<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethical Reflection - Lotus Educational Platform</title>
    <meta name="description" content="Reflect on predatory lending practices through interactive educational content and ethical analysis">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="./assets/styles/deceptive.css">
    <link rel="stylesheet" href="./assets/styles/ethical.css">
    
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="app-container">
        <!-- Navigation -->
        <nav class="main-nav">
            <div class="nav-container">
                <a href="index.html" class="nav-logo">Lotus Educational Platform</a>
                <div class="nav-links">
                    <a href="index.html">Home</a>
                    <a href="apply.html">Simulation</a>
                    <a href="reflect.html" class="active">Reflect</a>
                </div>
                <!-- Ghost Mode Toggle -->
                <div class="ghost-mode-toggle">
                    <label for="ghost-toggle">
                        <input type="checkbox" id="ghost-toggle" />
                        <span class="toggle-slider">Ghost Mode</span>
                    </label>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="reflection-page">
            <!-- Hero Section -->
            <section class="reflection-hero">
                <div class="container">
                    <h1>Ethical Reflection on Predatory Lending</h1>
                    <p>Explore the psychological and ethical dimensions of predatory lending practices through interactive educational content.</p>
                </div>
            </section>

            <!-- Educational Modules -->
            <section class="education-modules">
                <div class="container">
                    <h2>Educational Modules</h2>
                    
                    <!-- Dark Pattern Analysis -->
                    <div class="module-card">
                        <h3>Dark Pattern Analysis</h3>
                        <p>Learn to identify and understand psychological manipulation techniques used in predatory lending.</p>
                        <div class="dark-pattern-examples" id="dark-pattern-display">
                            <!-- Content populated by JavaScript -->
                        </div>
                        <button class="btn btn-primary" onclick="loadDarkPatternModule()">Explore Dark Patterns</button>
                    </div>

                    <!-- APR Education -->
                    <div class="module-card">
                        <h3>Understanding APR & True Cost</h3>
                        <p>Interactive calculator showing the real cost of payday loans vs. traditional lending.</p>
                        <div class="apr-calculator" id="apr-comparison">
                            <div class="calc-input">
                                <label for="loan-amount">Loan Amount: $</label>
                                <input type="number" id="loan-amount" value="500" min="100" max="5000" step="50">
                            </div>
                            <div class="calc-input">
                                <label for="loan-term">Term (days):</label>
                                <input type="number" id="loan-term" value="14" min="7" max="365">
                            </div>
                            <button class="btn btn-secondary" onclick="calculateAPRComparison()">Calculate Real Cost</button>
                            <div class="apr-results" id="apr-results">
                                <!-- Results populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Debt Cycle Simulation -->
                    <div class="module-card">
                        <h3>Debt Cycle Simulation</h3>
                        <p>Visualize how payday loans can trap borrowers in cycles of debt.</p>
                        <div class="debt-simulation" id="debt-cycle-viz">
                            <canvas id="debt-cycle-chart" width="400" height="200"></canvas>
                        </div>
                        <button class="btn btn-primary" onclick="runDebtCycleSimulation()">Simulate Debt Cycle</button>
                    </div>

                    <!-- Ethics Quiz -->
                    <div class="module-card">
                        <h3>Ethics Assessment</h3>
                        <p>Test your understanding of ethical lending practices and regulatory requirements.</p>
                        <div class="quiz-container" id="ethics-quiz">
                            <div class="quiz-intro">
                                <p>This interactive quiz will test your knowledge of:</p>
                                <ul>
                                    <li>Dark pattern recognition in lending interfaces</li>
                                    <li>APR calculations and true cost analysis</li>
                                    <li>Regulatory frameworks and consumer protections</li>
                                    <li>Psychological manipulation techniques</li>
                                    <li>Ethical alternatives to predatory lending</li>
                                </ul>
                                <button class="btn btn-primary" onclick="startQuiz('ethics-quiz')">Start Assessment</button>
                            </div>
                        </div>
                    </div>
                        </div>
                        <button class="btn btn-success" onclick="startEthicsQuiz()">Start Assessment</button>
                    </div>

                    <!-- Research & Documentation -->
                    <div class="module-card">
                        <h3>Research & Academic Resources</h3>
                        <p>Access academic research, regulatory documents, and further reading on predatory lending.</p>
                        <div class="resource-links">
                            <ul>
                                <li><a href="#" target="_blank">Academic References (Coming Soon)</a></li>
                                <li><a href="#" target="_blank">Ethical Philosophy Framework (Coming Soon)</a></li>
                                <li><a href="#" target="_blank">Design & Implementation Notes (Coming Soon)</a></li>
                                <li><a href="https://www.consumerfinance.gov/about-us/newsroom/cfpb-finds-payday-lenders-continue-to-trap-borrowers-in-debt/" target="_blank">CFPB Research on Payday Lending</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Educational Module Triggers -->
            <section class="educational-modules">
                <div class="container">
                    <h2>üìö Interactive Learning Modules</h2>
                    <div class="module-grid">
                        <div class="module-card">
                            <h3>üß† Behavioral Psychology</h3>
                            <p>Learn how cognitive biases are exploited in predatory lending</p>
                            <button onclick="window.LotusApp?.simulation?.startEducationalModule('behavioral-psychology')" class="btn-primary">
                                Start Module
                            </button>
                        </div>
                        <div class="module-card">
                            <h3>‚öñÔ∏è Legal Mechanisms</h3>
                            <p>Understand the legal loopholes that enable predatory practices</p>
                            <button onclick="window.LotusApp?.simulation?.startEducationalModule('legal-mechanisms')" class="btn-primary">
                                Start Module
                            </button>
                        </div>
                        <div class="module-card">
                            <h3>üîÑ Debt Cycle Mechanics</h3>
                            <p>Explore how the debt trap cycle works and how to escape it</p>
                            <button onclick="window.LotusApp?.simulation?.startEducationalModule('debt-cycle-mechanics')" class="btn-primary">
                                Start Module
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Rollover Simulation Demo -->
            <section class="rollover-demo">
                <div class="container">
                    <h2>üí∏ Experience the Debt Trap</h2>
                    <p>See how rollover cycles work in practice:</p>
                    <button onclick="window.LotusApp?.simulation?.simulateRollover()" class="btn-danger">
                        Simulate Rollover Trap
                    </button>
                </div>
            </section>

            <!-- Reflection Journal -->
            <section class="reflection-journal">
                <div class="container">
                    <h2>Personal Reflection</h2>
                    <div class="journal-card">
                        <h3>Reflection Questions</h3>
                        <div class="reflection-questions">
                            <div class="question">
                                <h4>1. What surprised you most about predatory lending practices?</h4>
                                <textarea id="reflection-1" placeholder="Share your thoughts..." rows="4"></textarea>
                            </div>
                            <div class="question">
                                <h4>2. How do you think we can better protect vulnerable consumers?</h4>
                                <textarea id="reflection-2" placeholder="Share your thoughts..." rows="4"></textarea>
                            </div>
                            <div class="question">
                                <h4>3. What role should technology play in ethical lending?</h4>
                                <textarea id="reflection-3" placeholder="Share your thoughts..." rows="4"></textarea>
                            </div>
                        </div>
                        <div class="journal-actions">
                            <button class="btn btn-primary" onclick="saveReflection()">Save Reflection</button>
                            <button class="btn btn-secondary" onclick="downloadReflection()">Download as PDF</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="container">
                <p>&copy; 2024 Lotus Educational Platform. Created for educational and research purposes.</p>
                <p>This simulation demonstrates predatory lending practices for educational awareness.</p>
            </div>
        </footer>
    </div>

    <!-- Ghost Mode Overlay -->
    <div id="ghost-overlay" class="ghost-overlay hidden">
        <div class="ghost-content">
            <h3>Ghost Mode Active</h3>
            <p>Educational overlays and ethical guidance are now visible.</p>
            <div id="ghost-insights">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Load Core Application -->
    <script type="module" src="./app.js"></script>
    
    <!-- Reflection Page Specific Scripts -->
    <script type="module">
        // Import from correct modules
        // import { UI } from './ui-components.js';
        // import { Config } from './lotus_core.js';
        
        // Initialize reflection page functionality
        document.addEventListener('DOMContentLoaded', function() {
            initializeReflectionPage();
        });

        function initializeReflectionPage() {
            // Ghost mode toggle functionality
            const ghostToggle = document.getElementById('ghost-toggle');
            const ghostOverlay = document.getElementById('ghost-overlay');
            
            ghostToggle.addEventListener('change', function() {
                if (this.checked) {
                    ghostOverlay.classList.remove('hidden');
                    document.body.classList.add('ghost-mode-active');
                    showGhostInsights();
                } else {
                    ghostOverlay.classList.add('hidden');
                    document.body.classList.remove('ghost-mode-active');
                }
            });
        }

        window.loadDarkPatternModule = function() {
            fetch('./data/ui_config.json')
                .then(response => response.json())
                .then(data => {
                    const display = document.getElementById('dark-pattern-display');
                    const patterns = data.darkPatterns;
                    
                    let html = '<div class="dark-pattern-grid">';
                    for (const [key, pattern] of Object.entries(patterns)) {
                        html += `
                            <div class="pattern-card">
                                <h4>${pattern.name}</h4>
                                <p>${pattern.description}</p>
                                <div class="pattern-examples">
                                    <strong>Examples:</strong>
                                    <ul>
                                        ${pattern.examples.map(ex => `<li>${ex}</li>`).join('')}
                                    </ul>
                                </div>
                                <div class="pattern-impact">
                                    <strong>Impact:</strong> ${pattern.psychological_impact}
                                </div>
                            </div>
                        `;
                    }
                    html += '</div>';
                    display.innerHTML = html;
                })
                .catch(err => console.error('Error loading dark patterns:', err));
        };

        window.calculateAPRComparison = function() {
            const amount = parseFloat(document.getElementById('loan-amount').value);
            const term = parseInt(document.getElementById('loan-term').value);
            const resultsDiv = document.getElementById('apr-results');
            
            // Predatory loan calculation (typical payday loan)
            const paydayFee = amount * 0.15; // 15% fee
            const paydayTotal = amount + paydayFee;
            const paydayAPR = ((paydayFee / amount) * (365 / term)) * 100;
            
            // Ethical loan calculation (credit union rates)
            const ethicalAPR = 18; // 18% annual rate
            const ethicalTotal = amount * (1 + (ethicalAPR / 100) * (term / 365));
            const ethicalFee = ethicalTotal - amount;
            
            resultsDiv.innerHTML = `
                <div class="apr-comparison-results">
                    <div class="loan-comparison">
                        <div class="predatory-loan">
                            <h4>Payday Loan</h4>
                            <p>Fee: $${paydayFee.toFixed(2)}</p>
                            <p>Total Repayment: $${paydayTotal.toFixed(2)}</p>
                            <p class="apr-highlight predatory">APR: ${paydayAPR.toFixed(0)}%</p>
                        </div>
                        <div class="ethical-loan">
                            <h4>Credit Union Loan</h4>
                            <p>Interest: $${ethicalFee.toFixed(2)}</p>
                            <p>Total Repayment: $${ethicalTotal.toFixed(2)}</p>
                            <p class="apr-highlight ethical">APR: ${ethicalAPR}%</p>
                        </div>
                    </div>
                    <div class="savings-highlight">
                        <p><strong>You save $${(paydayTotal - ethicalTotal).toFixed(2)} with ethical lending!</strong></p>
                    </div>
                </div>
            `;
        };

        window.runDebtCycleSimulation = function() {
            const canvas = document.getElementById('debt-cycle-chart');
            const ctx = canvas.getContext('2d');
            
            // Simulate debt accumulation over 12 months
            let balance = 500; // Starting loan
            let monthlyData = [balance];
            
            for (let month = 1; month <= 12; month++) {
                // Rollover with additional fees
                balance = balance * 1.15 + 50; // 15% rollover fee + $50 new borrowing
                monthlyData.push(balance);
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 13}, (_, i) => `Month ${i}`),
                    datasets: [{
                        label: 'Total Debt',
                        data: monthlyData,
                        borderColor: '#dc2626',
                        backgroundColor: 'rgba(220, 38, 38, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Payday Loan Debt Accumulation'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        }
                    }
                }
            });
        };

        window.startEthicsQuiz = function() {
            const quizContainer = document.getElementById('ethics-quiz');
            const questions = [
                {
                    question: "What is the maximum APR allowed for payday loans in most regulated states?",
                    options: ["36%", "100%", "400%", "No limit"],
                    correct: 0,
                    explanation: "Many states cap payday loan APRs at 36% to protect consumers."
                },
                {
                    question: "Which of these is considered a dark pattern?",
                    options: ["Clear fee disclosure", "Artificial urgency", "Multiple payment options", "Customer support"],
                    correct: 1,
                    explanation: "Artificial urgency pressures consumers into quick decisions without proper consideration."
                },
                {
                    question: "What percentage of payday borrowers renew or roll over their loans?",
                    options: ["20%", "50%", "80%", "95%"],
                    correct: 2,
                    explanation: "Studies show about 80% of payday loans are renewed within 14 days, indicating debt trap cycles."
                }
            ];
            
            let currentQuestion = 0;
            let score = 0;
            
            function showQuestion() {
                const q = questions[currentQuestion];
                quizContainer.innerHTML = `
                    <div class="quiz-question">
                        <h4>Question ${currentQuestion + 1} of ${questions.length}</h4>
                        <p>${q.question}</p>
                        <div class="quiz-options">
                            ${q.options.map((option, index) => 
                                `<button class="quiz-option" onclick="selectAnswer(${index})">${option}</button>`
                            ).join('')}
                        </div>
                    </div>
                `;
            }
            
            window.selectAnswer = function(selectedIndex) {
                const q = questions[currentQuestion];
                const correct = selectedIndex === q.correct;
                if (correct) score++;
                
                quizContainer.innerHTML += `
                    <div class="quiz-feedback ${correct ? 'correct' : 'incorrect'}">
                        <p><strong>${correct ? 'Correct!' : 'Incorrect.'}</strong></p>
                        <p>${q.explanation}</p>
                        <button class="btn btn-primary" onclick="nextQuestion()">
                            ${currentQuestion < questions.length - 1 ? 'Next Question' : 'View Results'}
                        </button>
                    </div>
                `;
            };
            
            window.nextQuestion = function() {
                currentQuestion++;
                if (currentQuestion < questions.length) {
                    showQuestion();
                } else {
                    showResults();
                }
            };
            
            function showResults() {
                const percentage = Math.round((score / questions.length) * 100);
                quizContainer.innerHTML = `
                    <div class="quiz-results">
                        <h4>Quiz Complete!</h4>
                        <p>You scored ${score} out of ${questions.length} (${percentage}%)</p>
                        <div class="score-interpretation">
                            ${percentage >= 80 ? 
                                '<p class="excellent">Excellent! You have a strong understanding of ethical lending practices.</p>' :
                                percentage >= 60 ?
                                '<p class="good">Good work! Consider reviewing the educational modules for areas of improvement.</p>' :
                                '<p class="needs-improvement">Consider spending more time with the educational content to better understand these important concepts.</p>'
                            }
                        </div>
                        <button class="btn btn-primary" onclick="startEthicsQuiz()">Retake Quiz</button>
                    </div>
                `;
            }
            
            showQuestion();
        };

        function showGhostInsights() {
            const insights = document.getElementById('ghost-insights');
            insights.innerHTML = `
                <div class="ghost-insight">
                    <h4>Educational Guidance Active</h4>
                    <p>üîç Look for highlighted elements that explain psychological tactics</p>
                    <p>üí° Ethical alternatives are now visible alongside predatory practices</p>
                    <p>üìä Real-time analysis of dark patterns and manipulation techniques</p>
                    <p>üéì Learning objectives and reflection prompts are now displayed</p>
                </div>
            `;
        }

        window.saveReflection = function() {
            const reflection1 = document.getElementById('reflection-1').value;
            const reflection2 = document.getElementById('reflection-2').value;
            const reflection3 = document.getElementById('reflection-3').value;
            
            const reflectionData = {
                timestamp: new Date().toISOString(),
                responses: {
                    question1: reflection1,
                    question2: reflection2,
                    question3: reflection3
                }
            };
            
            localStorage.setItem('lotus-reflection', JSON.stringify(reflectionData));
            alert('Reflection saved locally!');
        };

        window.downloadReflection = function() {
            const reflection1 = document.getElementById('reflection-1').value;
            const reflection2 = document.getElementById('reflection-2').value;
            const reflection3 = document.getElementById('reflection-3').value;
            
            const content = `
                Lotus Educational Platform - Personal Reflection
                Date: ${new Date().toLocaleDateString()}
                
                1. What surprised you most about predatory lending practices?
                ${reflection1}
                
                2. How do you think we can better protect vulnerable consumers?
                ${reflection2}
                
                3. What role should technology play in ethical lending?
                ${reflection3}
                
                ---
                Generated by Lotus Educational Platform
            `;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lotus-reflection.txt';
            a.click();
            URL.revokeObjectURL(url);
        };
        
        // Missing Interactive Functions for Reflect Page
        
        function loadDarkPatternModule() {
            alert('Dark Pattern Analysis Module Loading...\n\nThis would show real examples of:\n‚Ä¢ Urgency manipulation\n‚Ä¢ Hidden fees\n‚Ä¢ Social proof deception\n‚Ä¢ Psychological pressure tactics');
        }
        
        function calculateAPRComparison() {
            const predatoryAPR = 400; // Typical payday loan APR
            const ethicalAPR = 28;    // Credit union PAL APR
            const loanAmount = 500;
            const term = 14; // days
            
            const predatoryCost = (loanAmount * predatoryAPR / 100) * (term / 365);
            const ethicalCost = (loanAmount * ethicalAPR / 100) * (term / 365);
            const savings = predatoryCost - ethicalCost;
            
            alert(`APR Comparison Results:\n\n` +
                  `Predatory Loan (${predatoryAPR}% APR):\n` +
                  `Cost: $${predatoryCost.toFixed(2)}\n\n` +
                  `Ethical Loan (${ethicalAPR}% APR):\n` +
                  `Cost: $${ethicalCost.toFixed(2)}\n\n` +
                  `You Save: $${savings.toFixed(2)}`);
        }
        
        function runDebtCycleSimulation() {
            alert('Debt Cycle Simulation:\n\n' +
                  'Month 1: Borrow $500, owe $630\n' +
                  'Month 2: Can\'t pay, rollover + fees: $760\n' +
                  'Month 3: Rollover again: $920\n' +
                  'Month 4: Rollover again: $1,150\n' +
                  'Month 5: Rollover again: $1,420\n' +
                  'Month 6: Rollover again: $1,750\n\n' +
                  'Initial $500 loan becomes $1,750 debt trap!');
        }
        
        function startQuiz(quizType) {
            if (quizType === 'ethics-quiz') {
                startEthicsQuiz();
            } else {
                alert(`Starting ${quizType} quiz...`);
            }
        }
        
        function startEthicsQuiz() {
            // Use the existing quiz infrastructure
            if (window.LotusApp && window.LotusApp.quizEngine) {
                window.LotusApp.quizEngine.startQuiz();
            } else {
                // Fallback simple quiz
                let score = 0;
                const questions = [
                    {
                        q: "What is a typical APR for payday loans?",
                        options: ["25%", "100%", "400%", "600%"],
                        correct: 2
                    },
                    {
                        q: "What percentage of payday borrowers rollover their loans?",
                        options: ["10%", "25%", "50%", "80%"],
                        correct: 3
                    },
                    {
                        q: "Which is NOT a dark pattern in predatory lending?",
                        options: ["Hidden fees", "Urgency pressure", "Clear pricing", "Social proof manipulation"],
                        correct: 2
                    }
                ];
                
                questions.forEach((question, i) => {
                    const answer = prompt(`Question ${i+1}: ${question.q}\n\n` +
                                        question.options.map((opt, idx) => `${idx+1}. ${opt}`).join('\n') +
                                        '\n\nEnter your choice (1-4):');
                    if (parseInt(answer) - 1 === question.correct) score++;
                });
                
                alert(`Quiz Complete!\n\nYour Score: ${score}/${questions.length}\n\n` +
                      `${score === questions.length ? 'Perfect! You understand predatory lending well.' :
                        score >= questions.length/2 ? 'Good! Keep learning about financial protection.' :
                        'Consider reviewing the educational materials to better protect yourself.'}`);
            }
        }
        
        function saveReflection() {
            const reflection1 = document.getElementById('reflection-1')?.value || '';
            const reflection2 = document.getElementById('reflection-2')?.value || '';
            const reflection3 = document.getElementById('reflection-3')?.value || '';
            const allReflections = reflection1 + '\n\n' + reflection2 + '\n\n' + reflection3;
            
            if (allReflections.trim()) {
                localStorage.setItem('lotus-reflection', allReflections);
                alert('Reflection saved locally!');
            } else {
                alert('Please write a reflection first.');
            }
        }
        
        function downloadReflection() {
            const reflection1 = document.getElementById('reflection-1')?.value || '';
            const reflection2 = document.getElementById('reflection-2')?.value || '';
            const reflection3 = document.getElementById('reflection-3')?.value || '';
            const allReflections = reflection1 + '\n\n' + reflection2 + '\n\n' + reflection3;
            const savedReflection = localStorage.getItem('lotus-reflection') || '';
            const finalReflection = allReflections.trim() || savedReflection;
            
            if (!finalReflection.trim()) {
                alert('No reflection to download. Please write a reflection first.');
                return;
            }
            
            const blob = new Blob([`Lotus Educational Platform - Personal Reflection\n\n${finalReflection}`], 
                                 { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lotus-reflection.txt';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function selectAnswer(index) {
            // Handle quiz answer selection
            document.querySelectorAll('.quiz-option').forEach((btn, i) => {
                btn.classList.toggle('selected', i === index);
            });
            window.selectedAnswer = index;
        }
        
        function nextQuestion() {
            // Handle next question in quiz
            alert('Moving to next question...');
        }
        
        function demonstratePattern(patternType) {
            const demonstrations = {
                'urgency': 'URGENCY PATTERN DEMO:\n\n"‚ö° HURRY! Only 2 spots left!"\n"Offer expires in 3 minutes!"\n"Act NOW or lose this deal forever!"\n\nThese create false scarcity to pressure quick decisions.',
                'social-proof': 'SOCIAL PROOF PATTERN DEMO:\n\n"‚úì Sarah from TX just got approved!"\n"‚úì Mike from CA borrowed $500!"\n"‚úì Over 1000 people applied today!"\n\nFake social activity makes bad decisions seem normal.',
                'hidden-cost': 'HIDDEN COST PATTERN DEMO:\n\n"$15 fee*" (*plus $25 processing, $30 fast funding, $15 documentation)\n\nInitial fee looks small but hidden costs multiply the total.',
                'anchoring': 'ANCHORING PATTERN DEMO:\n\n"Normal rate: 500% APR"\n"YOUR SPECIAL RATE: 400% APR"\n"You save 100%!"\n\nMakes terrible rates seem like a good deal.'
            };
            
            alert(demonstrations[patternType] || 'Pattern demonstration not found.');
        }
    </script>
    
    <!-- Load main application modules -->
    <script src="./global.js"></script>
    <script type="module" src="./utils.js"></script>
    <script type="module" src="./ui-components.js"></script>
    <script type="module" src="./lotus_core.js"></script>
    <script type="module" src="./autonomy_theater.js"></script>
    <script type="module" src="./app.js"></script>
    
    <script type="module">
        // Set page context
        window.LOTUS_PAGE_CONTEXT = 'reflect';
        
        // Initialize the page after all modules load
        document.addEventListener('DOMContentLoaded', async function() {
            // Wait for LotusApp to be available
            while (!window.LotusApp) {
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            // Initialize the application
            await window.LotusApp.initialize();
            
            console.log('Lotus application loaded for reflection page');
        });
    </script>
</body>
</html>
